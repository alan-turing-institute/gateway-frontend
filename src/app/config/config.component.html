<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
        <div class="card-header">
          <strong>About</strong>
        </div>
        <div class="card">  
          <caseDescription [info] = "case"></caseDescription>
          <div class="row">
            <div class="col-md-12">
                <label>Name:</label>
                <input type="text"
                class="form-control"
                [(ngModel)]="job.name"
                (keyup.enter)="updateName(job.name)"
                (change) = "updateName(job.name)"
                (blur)="updateName(job.name)">
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">  
              <label>Description</label>
              <textarea
              rows = "3"
              class="form-control"
              [(ngModel)]=job.description
              (keyup.enter)="updateDescription(job.description)"
              (blur)="updateDescription(job.description)"></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col-md-3">
              <button type="button" class="btn btn-primary btn-action" (click)="saveJob()" [disabled]=!validFormValues>
                <span>Save</span>
              </button>
            <div class="col-md-4">
                <button type="button"
                        class="btn btn-primary btn-action"
                        routerLinkActive="active"
                        (click)="runJob()"
                        [disabled]=!validFormValues
                        [hidden]=!jobCreated>
                  <span>Run</span>
                </button>
              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-12">
      <div class="card-header">
        <strong>Configuration</strong>
      </div>
      <div class = "card">
      <div [attr.id]="componentFamilyAccordion" role="tablist">
        <div *ngFor="let tag of tags" class="card card-family" >
          <div class="card-header config" role="tab" (click)="toggleCollapse(tag)">
            <h5 class="mb-0">
              <a data-toggle="collapse" data-target={{getDataTarget(tag)}} data-parent="#componentFamilyAccordion">
                {{tag.label}}
              </a>
            </h5>
          </div>
          <div [attr.id]=tag.name [ngClass]="{'collapse': tag.collapse }"role="tabpanel">
            <div class="card-block">
              <div *ngIf="tag.name == 'tank_properties'">
                <app-tank [data]="tag.parameters"></app-tank>
                <div class="row">
                  <div *ngFor="let component of getVisibleComponents(tag)" class="col-md-6">
                    <div *ngIf="component.type == 'slider'">
                      <label [for]=component.name>{{component.label}}</label>
                      <ion-range-slider
                        [attr.id]=component.name
                        from={{component.value}}
                        min={{component.min_value}}
                        max={{component.max_value}}
                        data-step={{component.step}}
                        postfix=" {{component.units}}"
                        (onFinish)="updateSlider(tag, component, $event)"
                        [disable]="isDisabled()">
                      </ion-range-slider>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="tag.name == 'pipe_properties'">
                <app-pipe [data]="tag.parameters"></app-pipe>
                <div class="row">
                  <div *ngFor="let component of getVisibleComponents(tag)" class="col-md-6">
                    <div *ngIf="component.type == 'slider'">
                      <label [for]=component.name>{{component.label}}</label>
                      <ion-range-slider
                        [attr.id]=component.name
                        from={{component.value}}
                        min={{component.min_value}}
                        max={{component.max_value}}
                        data-step={{component.step}}
                        postfix=" {{component.units}}"
                        (onFinish)="updateSlider(tag, component, $event)"
                        [disable]="isDisabled()">
                      </ion-range-slider>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="!(['tank_properties', 'pipe_properties'].includes(tag.name))">
                <div class="row">
                  <div *ngFor="let component of getVisibleComponents(tag)" class="col-md-6">
                    <textInput [aComponent]="component"></textInput>
                      <!-- <div *ngIf="component.type == 'text'">
                        <label [for]=component.name>{{component.label}} <span [hidden]="component.valid" [ngClass]="{'invalidValue': component.valid === false}">*Valid values ranges between {{component.min_value}} and {{component.max_value}}</span>
                        </label>
                        <div class="input-group"  >
                          <input
                            [(ngModel)]="component.value"
                            (ngModelChange) = "validateValue(component)"
                            [attr.id]="component.name"
                            type="number"
                            [ngClass]="{'invalidValue': component.valid === false}"
                            (keyup.enter)="update(tag,component)"
                            (blur)="update(tag, component)"
                            [disabled]="isDisabled()"
                          >
                          <span class="input-group-addon">{{component.units}}</span>
                        </div>
                      </div> -->
                      <div *ngIf="component.type == 'radio'">
                        <label class="switch switch-3d switch-danger">
                          <input type="checkbox"
                            class="switch-input"
                            [ngModel] = "component.value"
                            (ngModelChange)="update(tag, component)"
                            [disabled]="isDisabled()">
                          <span class="switch-label"></span>
                          <span class="switch-handle"></span>
                        </label>
                        {{component.units}}
                      </div>
                      <div *ngIf="component.type == 'slider'">
                        <label [for]=component.name>{{component.label}}</label>
                        <ion-range-slider
                          [attr.id]=component.name
                          from={{component.value}}
                          min={{component.min_value}}
                          max={{component.max_value}}
                          data-step={{component.step}}
                          postfix=" {{component.units}}"
                          (onFinish)="updateSlider(tag, component, $event)"
                          [disable]="isDisabled()">
                        </ion-range-slider>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>
